{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _mongoObject = _interopRequireDefault(require(\"mongo-object\"));\n\nvar _doValidation = _interopRequireDefault(require(\"./doValidation.js\"));\n\nvar _lodash = _interopRequireDefault(require(\"lodash.findwhere\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar ValidationContext = /*#__PURE__*/function () {\n  function ValidationContext(ss) {\n    var _this = this;\n\n    _classCallCheck(this, ValidationContext);\n\n    this._simpleSchema = ss;\n    this._schema = ss.schema();\n    this._schemaKeys = Object.keys(this._schema);\n    this._validationErrors = []; // Set up validation dependencies\n\n    this._deps = {};\n    var tracker = ss._constructorOptions.tracker;\n\n    if (tracker) {\n      this._depsAny = new tracker.Dependency();\n\n      this._schemaKeys.forEach(function (key) {\n        _this._deps[key] = new tracker.Dependency();\n      });\n    }\n  }\n\n  _createClass(ValidationContext, [{\n    key: \"_markKeyChanged\",\n    value: function _markKeyChanged(key) {\n      var genericKey = _mongoObject[\"default\"].makeKeyGeneric(key);\n\n      if (this._deps.hasOwnProperty(genericKey)) this._deps[genericKey].changed();\n    }\n  }, {\n    key: \"_markKeysChanged\",\n    value: function _markKeysChanged(keys) {\n      var _this2 = this;\n\n      if (!keys || !Array.isArray(keys) || !keys.length) return;\n      keys.forEach(function (key) {\n        return _this2._markKeyChanged(key);\n      });\n      this._depsAny && this._depsAny.changed();\n    }\n  }, {\n    key: \"setValidationErrors\",\n    value: function setValidationErrors(errors) {\n      var previousValidationErrors = this._validationErrors.map(function (o) {\n        return o.name;\n      });\n\n      var newValidationErrors = errors.map(function (o) {\n        return o.name;\n      });\n      this._validationErrors = errors; // Mark all previous plus all new as changed\n\n      var changedKeys = previousValidationErrors.concat(newValidationErrors);\n\n      this._markKeysChanged(changedKeys);\n    }\n  }, {\n    key: \"addValidationErrors\",\n    value: function addValidationErrors(errors) {\n      var _this3 = this;\n\n      var newValidationErrors = errors.map(function (o) {\n        return o.name;\n      });\n      errors.forEach(function (error) {\n        return _this3._validationErrors.push(error);\n      }); // Mark all new as changed\n\n      this._markKeysChanged(newValidationErrors);\n    } // Reset the validationErrors array\n\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.setValidationErrors([]);\n    }\n  }, {\n    key: \"getErrorForKey\",\n    value: function getErrorForKey(key) {\n      var genericKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _mongoObject[\"default\"].makeKeyGeneric(key);\n      var errors = this._validationErrors;\n      return (0, _lodash[\"default\"])(errors, {\n        name: key\n      }) || (0, _lodash[\"default\"])(errors, {\n        name: genericKey\n      });\n    }\n  }, {\n    key: \"_keyIsInvalid\",\n    value: function _keyIsInvalid(key, genericKey) {\n      return !!this.getErrorForKey(key, genericKey);\n    } // Like the internal one, but with deps\n\n  }, {\n    key: \"keyIsInvalid\",\n    value: function keyIsInvalid(key) {\n      var genericKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _mongoObject[\"default\"].makeKeyGeneric(key);\n      if (this._deps.hasOwnProperty(genericKey)) this._deps[genericKey].depend();\n      return this._keyIsInvalid(key, genericKey);\n    }\n  }, {\n    key: \"keyErrorMessage\",\n    value: function keyErrorMessage(key) {\n      var genericKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _mongoObject[\"default\"].makeKeyGeneric(key);\n      if (this._deps.hasOwnProperty(genericKey)) this._deps[genericKey].depend();\n      var errorObj = this.getErrorForKey(key, genericKey);\n      if (!errorObj) return '';\n      return this._simpleSchema.messageForError(errorObj);\n    }\n    /**\n     * Validates the object against the simple schema and sets a reactive array of error objects\n     */\n\n  }, {\n    key: \"validate\",\n    value: function validate(obj) {\n      var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          _ref$extendedCustomCo = _ref.extendedCustomContext,\n          extendedCustomContext = _ref$extendedCustomCo === void 0 ? {} : _ref$extendedCustomCo,\n          _ref$ignore = _ref.ignore,\n          ignoreTypes = _ref$ignore === void 0 ? [] : _ref$ignore,\n          keysToValidate = _ref.keys,\n          _ref$modifier = _ref.modifier,\n          isModifier = _ref$modifier === void 0 ? false : _ref$modifier,\n          mongoObject = _ref.mongoObject,\n          _ref$upsert = _ref.upsert,\n          isUpsert = _ref$upsert === void 0 ? false : _ref$upsert;\n\n      var validationErrors = (0, _doValidation[\"default\"])({\n        extendedCustomContext: extendedCustomContext,\n        ignoreTypes: ignoreTypes,\n        isModifier: isModifier,\n        isUpsert: isUpsert,\n        keysToValidate: keysToValidate,\n        mongoObject: mongoObject,\n        obj: obj,\n        schema: this._simpleSchema,\n        validationContext: this\n      });\n\n      if (keysToValidate) {\n        // We have only revalidated the listed keys, so if there\n        // are any other existing errors that are NOT in the keys list,\n        // we should keep these errors.\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          var _loop = function _loop() {\n            var error = _step.value;\n            var wasValidated = keysToValidate.some(function (key) {\n              return key === error.name || error.name.startsWith(\"\".concat(key, \".\"));\n            });\n            if (!wasValidated) validationErrors.push(error);\n          };\n\n          for (var _iterator = this._validationErrors[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            _loop();\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n              _iterator[\"return\"]();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n      }\n\n      this.setValidationErrors(validationErrors); // Return true if it was valid; otherwise, return false\n\n      return !validationErrors.length;\n    }\n  }, {\n    key: \"isValid\",\n    value: function isValid() {\n      this._depsAny && this._depsAny.depend();\n      return this._validationErrors.length === 0;\n    }\n  }, {\n    key: \"validationErrors\",\n    value: function validationErrors() {\n      this._depsAny && this._depsAny.depend();\n      return this._validationErrors;\n    }\n  }, {\n    key: \"clean\",\n    value: function clean() {\n      var _this$_simpleSchema;\n\n      return (_this$_simpleSchema = this._simpleSchema).clean.apply(_this$_simpleSchema, arguments);\n    }\n  }]);\n\n  return ValidationContext;\n}();\n\nexports[\"default\"] = ValidationContext;\nmodule.exports = exports.default;\nmodule.exports.default = exports.default;","map":{"version":3,"sources":["C:/Users/asus/Desktop/new template/myadmin-lite/node_modules/simpl-schema/dist/ValidationContext.js"],"names":["Object","defineProperty","exports","value","_mongoObject","_interopRequireDefault","require","_doValidation","_lodash","obj","__esModule","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","prototype","ValidationContext","ss","_this","_simpleSchema","_schema","schema","_schemaKeys","keys","_validationErrors","_deps","tracker","_constructorOptions","_depsAny","Dependency","forEach","_markKeyChanged","genericKey","makeKeyGeneric","hasOwnProperty","changed","_markKeysChanged","_this2","Array","isArray","setValidationErrors","errors","previousValidationErrors","map","o","name","newValidationErrors","changedKeys","concat","addValidationErrors","_this3","error","push","reset","getErrorForKey","arguments","undefined","_keyIsInvalid","keyIsInvalid","depend","keyErrorMessage","errorObj","messageForError","validate","_ref","_ref$extendedCustomCo","extendedCustomContext","_ref$ignore","ignore","ignoreTypes","keysToValidate","_ref$modifier","modifier","isModifier","mongoObject","_ref$upsert","upsert","isUpsert","validationErrors","validationContext","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_loop","_step","wasValidated","some","startsWith","_iterator","Symbol","iterator","next","done","err","isValid","clean","_this$_simpleSchema","apply","module","default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _mongoObject = _interopRequireDefault(require(\"mongo-object\"));\n\nvar _doValidation = _interopRequireDefault(require(\"./doValidation.js\"));\n\nvar _lodash = _interopRequireDefault(require(\"lodash.findwhere\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar ValidationContext =\n/*#__PURE__*/\nfunction () {\n  function ValidationContext(ss) {\n    var _this = this;\n\n    _classCallCheck(this, ValidationContext);\n\n    this._simpleSchema = ss;\n    this._schema = ss.schema();\n    this._schemaKeys = Object.keys(this._schema);\n    this._validationErrors = []; // Set up validation dependencies\n\n    this._deps = {};\n    var tracker = ss._constructorOptions.tracker;\n\n    if (tracker) {\n      this._depsAny = new tracker.Dependency();\n\n      this._schemaKeys.forEach(function (key) {\n        _this._deps[key] = new tracker.Dependency();\n      });\n    }\n  }\n\n  _createClass(ValidationContext, [{\n    key: \"_markKeyChanged\",\n    value: function _markKeyChanged(key) {\n      var genericKey = _mongoObject[\"default\"].makeKeyGeneric(key);\n\n      if (this._deps.hasOwnProperty(genericKey)) this._deps[genericKey].changed();\n    }\n  }, {\n    key: \"_markKeysChanged\",\n    value: function _markKeysChanged(keys) {\n      var _this2 = this;\n\n      if (!keys || !Array.isArray(keys) || !keys.length) return;\n      keys.forEach(function (key) {\n        return _this2._markKeyChanged(key);\n      });\n      this._depsAny && this._depsAny.changed();\n    }\n  }, {\n    key: \"setValidationErrors\",\n    value: function setValidationErrors(errors) {\n      var previousValidationErrors = this._validationErrors.map(function (o) {\n        return o.name;\n      });\n\n      var newValidationErrors = errors.map(function (o) {\n        return o.name;\n      });\n      this._validationErrors = errors; // Mark all previous plus all new as changed\n\n      var changedKeys = previousValidationErrors.concat(newValidationErrors);\n\n      this._markKeysChanged(changedKeys);\n    }\n  }, {\n    key: \"addValidationErrors\",\n    value: function addValidationErrors(errors) {\n      var _this3 = this;\n\n      var newValidationErrors = errors.map(function (o) {\n        return o.name;\n      });\n      errors.forEach(function (error) {\n        return _this3._validationErrors.push(error);\n      }); // Mark all new as changed\n\n      this._markKeysChanged(newValidationErrors);\n    } // Reset the validationErrors array\n\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.setValidationErrors([]);\n    }\n  }, {\n    key: \"getErrorForKey\",\n    value: function getErrorForKey(key) {\n      var genericKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _mongoObject[\"default\"].makeKeyGeneric(key);\n      var errors = this._validationErrors;\n      return (0, _lodash[\"default\"])(errors, {\n        name: key\n      }) || (0, _lodash[\"default\"])(errors, {\n        name: genericKey\n      });\n    }\n  }, {\n    key: \"_keyIsInvalid\",\n    value: function _keyIsInvalid(key, genericKey) {\n      return !!this.getErrorForKey(key, genericKey);\n    } // Like the internal one, but with deps\n\n  }, {\n    key: \"keyIsInvalid\",\n    value: function keyIsInvalid(key) {\n      var genericKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _mongoObject[\"default\"].makeKeyGeneric(key);\n      if (this._deps.hasOwnProperty(genericKey)) this._deps[genericKey].depend();\n      return this._keyIsInvalid(key, genericKey);\n    }\n  }, {\n    key: \"keyErrorMessage\",\n    value: function keyErrorMessage(key) {\n      var genericKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _mongoObject[\"default\"].makeKeyGeneric(key);\n      if (this._deps.hasOwnProperty(genericKey)) this._deps[genericKey].depend();\n      var errorObj = this.getErrorForKey(key, genericKey);\n      if (!errorObj) return '';\n      return this._simpleSchema.messageForError(errorObj);\n    }\n    /**\n     * Validates the object against the simple schema and sets a reactive array of error objects\n     */\n\n  }, {\n    key: \"validate\",\n    value: function validate(obj) {\n      var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          _ref$extendedCustomCo = _ref.extendedCustomContext,\n          extendedCustomContext = _ref$extendedCustomCo === void 0 ? {} : _ref$extendedCustomCo,\n          _ref$ignore = _ref.ignore,\n          ignoreTypes = _ref$ignore === void 0 ? [] : _ref$ignore,\n          keysToValidate = _ref.keys,\n          _ref$modifier = _ref.modifier,\n          isModifier = _ref$modifier === void 0 ? false : _ref$modifier,\n          mongoObject = _ref.mongoObject,\n          _ref$upsert = _ref.upsert,\n          isUpsert = _ref$upsert === void 0 ? false : _ref$upsert;\n\n      var validationErrors = (0, _doValidation[\"default\"])({\n        extendedCustomContext: extendedCustomContext,\n        ignoreTypes: ignoreTypes,\n        isModifier: isModifier,\n        isUpsert: isUpsert,\n        keysToValidate: keysToValidate,\n        mongoObject: mongoObject,\n        obj: obj,\n        schema: this._simpleSchema,\n        validationContext: this\n      });\n\n      if (keysToValidate) {\n        // We have only revalidated the listed keys, so if there\n        // are any other existing errors that are NOT in the keys list,\n        // we should keep these errors.\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          var _loop = function _loop() {\n            var error = _step.value;\n            var wasValidated = keysToValidate.some(function (key) {\n              return key === error.name || error.name.startsWith(\"\".concat(key, \".\"));\n            });\n            if (!wasValidated) validationErrors.push(error);\n          };\n\n          for (var _iterator = this._validationErrors[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            _loop();\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n              _iterator[\"return\"]();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n      }\n\n      this.setValidationErrors(validationErrors); // Return true if it was valid; otherwise, return false\n\n      return !validationErrors.length;\n    }\n  }, {\n    key: \"isValid\",\n    value: function isValid() {\n      this._depsAny && this._depsAny.depend();\n      return this._validationErrors.length === 0;\n    }\n  }, {\n    key: \"validationErrors\",\n    value: function validationErrors() {\n      this._depsAny && this._depsAny.depend();\n      return this._validationErrors;\n    }\n  }, {\n    key: \"clean\",\n    value: function clean() {\n      var _this$_simpleSchema;\n\n      return (_this$_simpleSchema = this._simpleSchema).clean.apply(_this$_simpleSchema, arguments);\n    }\n  }]);\n\n  return ValidationContext;\n}();\n\nexports[\"default\"] = ValidationContext;\nmodule.exports = exports.default;\nmodule.exports.default = exports.default;"]},"metadata":{},"sourceType":"script"}